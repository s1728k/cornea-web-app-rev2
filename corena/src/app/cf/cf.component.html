<div class="container-fluid unselectable">
    <div class="row">
        <div class="col-md-12">
            <h3 class="unselectable heading">Co-efficiency Factor Calculations</h3>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
                <div class="flex-box float-right">
                    <ng-container *ngIf="ed['edit']">
                    <button md-raised-button (click)="putCFFactor(); ed['edit']=false;">Edit</button>
                    <button md-raised-button (click)="resetNew(); ed['edit']=false;">Cancel</button>
                    </ng-container>
                    <button md-raised-button (click)="postCFFactor()" *ngIf="!ed['edit']">Save</button>
                </div>
                    <table>
                        <thead>
                            <tr>
                                <th width="40px;" class="index">
                                  <app-icon [iconName]="'ic_add_box_white_24px'" (click)="addSubMaterial()"></app-icon>
                                </th>
                                <th width="40px;">Sr.No</th>
                                <th width="200px;">Description</th>
                                <th width="200px;">Item Name</th>
                                <th width="40px;">Price</th>
                                <th width="40px;">UOM</th>
                                <th width="100px;">Type (mm)</th>
                                <th width="80px;">Cf_Price</th>
                            </tr>
                            <tr>
                                <th></th>
                                <th>1</th>
                                <th><input type="text" class="inp" [(ngModel)]="newCFFactor['description']"></th>
                                <th>
                                    <md-input-container>
                                          <input mdInput placeholder="Material" type="text" [mdAutocomplete]="auto"
                                          [(ngModel)]="cfMaterial" (keyup)="search(cfMaterial, '&conditions[has_cf]=1')">
                                        </md-input-container>

                                        <md-autocomplete #auto="mdAutocomplete">
                                            <ng-container *ngIf="materialsDropDown">
                                              <md-option *ngFor="let material of materialsDropDown" [value]="material.name"
                                              (click)="loadCfMaterial(material)">
                                                {{ material.name }}
                                              </md-option>
                                            </ng-container>
                                        </md-autocomplete>
                                </th>
                                <th><input type="number" class="inp" [(ngModel)]="newCFFactor['price']"></th>
                                <th><input type="text" class="inp" [(ngModel)]="newCFFactor['uom']"></th>
                                <th><input type="number" class="inp" ></th>
                                <th><input type="number" class="inp" ></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let submaterial of newCFFactor.submaterials; let i=index">
                                <td  class="index">
                                  <app-icon [iconName]="'ic_delete_white_24px'" (click)="deleteSubMaterial(i)"></app-icon>
                                </td>
                                <td>{{newCFFactor.submaterials[i].srno}}</td>
                                <td></td>
                                <td>
                                    <md-input-container>
                                      <input mdInput placeholder="Material" type="text" [mdAutocomplete]="auto"
                                      [(ngModel)]="newCFFactor.submaterials[i].name" (keyup)="search(newCFFactor.submaterials[i].name,'')">
                                    </md-input-container>

                                    <md-autocomplete #auto="mdAutocomplete">
                                        <ng-container *ngIf="materialsDropDown">
                                          <md-option *ngFor="let submaterial of materialsDropDown" [value]="submaterial.name"
                                          (click)="updateRow(submaterial, i)" (click)="newCFFactor.submaterials[i].item_id=submaterial.id">
                                            {{ submaterial.name }}
                                          </md-option>
                                        </ng-container>
                                    </md-autocomplete>
                                </td>
                                <td><input type="number" class="inp" name="price" [(ngModel)]="newCFFactor.submaterials[i].rate" (change)="cf_priceCalc(i)"></td>
                                <td><input type="text" class="inp" name="uom" [(ngModel)]="newCFFactor.submaterials[i].uom" (change)="cf_priceCalc(i)"></td>
                                <td><input type="number" class="inp" name="type" [(ngModel)]="newCFFactor.submaterials[i].type" (change)="cf_priceCalc(i)"></td>
                                <td>{{newCFFactor.submaterials[i].cf_price | number : '2.1-2'| nan}}</td>
                            </tr>
                        </tbody>
                    </table>

                    <label>Grand Total For CF Price</label>
                    <table class="auto-table">
                        <thead>
                            <th *ngFor="let key of keys">{{key}}mm</th>
                        </thead>
                        <thead>
                            <td *ngFor="let key of keys">{{tcf_price[key] | number : '2.1-2'| nan}}</td>
                        </thead>
                    </table>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <h3 class="unselectable heading">
                Co-efficiency List
            </h3>
        </div>
    </div>

    <div class="row flex-box b-margin">
        <div class="col-md-9" >
            <app-pagination *ngIf="pageCount" [pageCount]="pageCount" [activePage]="activePage"
            (pageSelected)=selectPage($event) (perPageCount)="perPageCountChange($event)">
            </app-pagination>
        </div>
        <div class="col-md-3">
            <input type='text' class="full-width search-box" placeholder='Search Whole Table...' (keyup)='generalFilter($event, 0)' />
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <table>
                <thead>
                    <tr>
                        <th width="5%">Sr.No.</th>
                        <th width="30%">Description</th>
                        <th width="25%">Item Name</th>
                        <th width="15%">Rate</th>
                        <th width="5%">UOM</th>
                        <th width="10%">Type</th>
                        <th width="10%">Cf_Price</th>
                        <th width="10%" colspan="2"></th>
                    </tr>
                    <tr>
                        <td width="5%">
                            <input type='text' class="full-width"
                            placeholder='Sr.No...' (keyup)='individualFilter(searchOpt, "srno", 0)' [(ngModel)]="searchOpt['srno']" name="srno" />
                        </td>
                        <td width="30%">
                            <input type='text' class="full-width"
                            placeholder='Desc...' (keyup)='individualFilter(searchOpt, "description", 0)' [(ngModel)]="searchOpt['description']" name="description" />
                        </td>
                        <td width="25%">
                            <input type='text' class="full-width"
                            placeholder='ItemName...' (keyup)='individualFilter(searchOpt, "item_name", 0)' [(ngModel)]="searchOpt['item_name']" name="item_nme" />
                        </td>
                        <td width="15%">
                            <input type='text' class="full-width"
                            placeholder='Rate...' (keyup)='individualFilter(searchOpt, "rate", 0)' [(ngModel)]="searchOpt['rate']" name="rate" />
                        </td>
                        <td width="5%">
                            <input type='text' class="full-width"
                            placeholder='Uom' (keyup)='individualFilter(searchOpt, "uom", 0)' [(ngModel)]="searchOpt['uom']" name="uom" />
                        </td>
                        <td width="5%">
                            <input type='text' class="full-width"
                            placeholder='Type' (keyup)='individualFilter(searchOpt, "type", 0)' [(ngModel)]="searchOpt['type']" name="type" />
                        </td>
                        <td width="10%">
                            <input type='text' class="full-width"
                            placeholder='cf_price' (keyup)='individualFilter(searchOpt, "cf_price", 0)' [(ngModel)]="searchOpt['cf_price']" name="cf_price" />
                        </td>
                        <td width="10%" colspan="2"></td>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let cfFactor of cfFactors; let i=index">
                        <td width="5%">{{cfFactor['srno']}}</td>
                        <td width="30%">{{cfFactor['description']}}</td>
                        <ng-container *ngIf="cfFactor['material']">
                            <td width="25%">{{cfFactor['material']['name']}}</td>
                        </ng-container>
                        <ng-container *ngIf="!cfFactor['material']">
                            <td width="25%">{{cfFactor['item_id']}}</td>
                        </ng-container>
                        <td width="5%">{{cfFactor['price']}}</td>
                        <td width="15%">{{cfFactor['uom']}}</td>
                        <td width="10%">{{cfFactor['type']}}</td>
                        <td width="10%">{{cfFactor['cf_price']}}</td>
                        <td width="2%" class="index">
                            <app-icon [iconName]="'ic_create_white_24px'" (click)="loadCFFactorForEdit(cfFactor)"></app-icon>
                        </td>
                        <td width="2%" class="index">
                            <app-icon [iconName]="'ic_delete_white_24px'" (click)="deleteCFFactor(cfFactor)"></app-icon>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>