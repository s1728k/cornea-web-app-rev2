<md-tab-group>
  <md-tab label="Rate Analysis">
    <div class="container-fluid unselectable">
        <div class="row">
            <div class="col-md-7">
                <table>
                    <thead>
                        <tr>
                            <th>Project Name</th>
                            <th>Boq Name</th>
                            <th>Rate Analysis</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                        <td>
                            <input mdInput placeholder="Project Name" class="inp" type="text" [mdAutocomplete]="projectss" #projectTerm
                                    (keyup)="searchProjects(projectTerm.value)">
                            <md-autocomplete #projectss="mdAutocomplete">
                              <md-option *ngFor="let project of projects | async" [value]="project.id">
                                {{ project.name }}
                              </md-option>
                            </md-autocomplete>
                        </td>
                        <td>
                            <input mdInput placeholder="Boq Name" class="inp" type="text" [mdAutocomplete]="boqss" #boqTerm
                                    (keyup)="searchBoqs(boqTerm.value)">
                            <md-autocomplete #boqss="mdAutocomplete">
                              <md-option *ngFor="let boq of boqs | async" [value]="boq.name">
                                {{ boq.name }}
                              </md-option>
                            </md-autocomplete>
                        </td>
                        <td>
                            <input mdInput placeholder="Boq Name" class="inp" type="text" [mdAutocomplete]="boqss" #boqTerm
                                    (keyup)="searchBoqs(boqTerm.value)">
                            <md-autocomplete #boqss="mdAutocomplete">
                              <md-option *ngFor="let boq of boqs | async" [value]="boq.name">
                                {{ boq.name }}
                              </md-option>
                            </md-autocomplete>
                        </td>
                        <td class="index">
                            <app-icon [iconName]="'ic_library_add_white_24px'"></app-icon>
                            <app-icon [iconName]="'ic_delete_white_24px'"></app-icon>
                        </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-4 align-right">
                <table>
                    <thead>
                        <tr>
                            <th>Over Head (%)</th>
                            <th>Profit (%)</th>
                            <th>Wastage (%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                        <td><input mdInput class="inp" color="primary" type="number" placeholder="Over Head (%)" [(ngModel)]="overhead" (change)="overheadCurrection()"></td>
                        <td><input mdInput class="inp" type="number" placeholder="Profit (%)" [(ngModel)]="profit" (change)="profitCurrection()"></td>
                        <td><input mdInput class="inp" type="number" placeholder="Wastage (%)" [(ngModel)]="wastage" (change)="wastageCurrection()"></td>
                        </tr>
                    </tbody>
                </table>

            </div>
        </div>

        <div class="row">
            <br>
        </div>
<ng-container *ngFor="let lineItem of lineItems; let i=index">
        <div class="row">
            <div class="col-md-12">
                <h4 class="heading" (click)="dl[i]=!dl[i]">{{lineItem['title']}} Rate analysis</h4>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                    <table>
                        <thead>
                            <tr>
                                <th width="2%" class="index">
                                  <app-icon [iconName]="'ic_add_box_white_24px'" (click)="addMaterialRateAnalysis(i)"></app-icon>
                                </th>
                                <th width="3%">Sr.No</th>
                                <th width="30%">Particular</th>
                                <th colspan="3">Size (L x B x T)</th>
                                <th width="5%">Quantity</th>
                                <th width="3%">Uom</th>
                                <th width="5%">Wastage(%)</th>
                                <th width="15%">Rate</th>
                                <th width="7%">CF</th>
                                <th width="15%">Amount</th>
                            </tr>
                            <tr>
                                <th></th>
                                <th><input type="text" class="inp" name="srno" [(ngModel)]="lineItems[i]['srno']"></th>
                                <th><input type="text" class="inp" name="title" [(ngModel)]="lineItems[i]['title']"></th>
                                <th width="5%"><input type="text" class="inp" name="ln" [(ngModel)]="lineItems[i]['length']"></th>
                                <th width="5%"><input type="text" class="inp" name="bd" [(ngModel)]="lineItems[i]['breadth']"></th>
                                <th width="5%"><input type="text" class="inp" name="th" [(ngModel)]="lineItems[i]['thickness']"></th>
                                <th><input type="text" class="inp" name="qt" [(ngModel)]="lineItems[i]['quantity']"></th>
                                <th><input type="text" class="inp" name="un" [(ngModel)]="lineItems[i]['unit']"></th>
                                <th><input type="text" class="inp" name="ws" [(ngModel)]="lineItems[i]['wastage']"></th>
                                <th><input type="text" class="inp" name="rt" [(ngModel)]="lineItems[i]['rate']"></th>
                                <th><input type="cf" class="inp" name="inp" [(ngModel)]="lineItems[i]['cf']"></th>
                                <th><input type="text" class="inp" name="amt" [(ngModel)]="lineItems[i]['amount']"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let mat of itemRateAnalysis[i].material_rate_analysis; let j=index">
                                <td class="index">
                                  <app-icon [iconName]="'ic_delete_white_24px'" (click)="deleteMaterialRateAnalysis(i,j)"></app-icon>
                                </td>
                                <td>{{itemRateAnalysis[i].material_rate_analysis[j]['srno']}}</td>
                                <td>
                                    <input mdInput placeholder="Material" class="inp" type="text" [mdAutocomplete]="auto" #searchBox
                                    (keyup)="searchMaterials(searchBox.value)">
                                    <md-autocomplete #auto="mdAutocomplete">
                                      <md-option *ngFor="let material of materials | async" [value]="material.name" (click)="updateRow(material,i,j)">
                                        {{ material.name }}
                                      </md-option>
                                    </md-autocomplete>
                                </td>
                                <td><input mdInput type="number" class="inp" name="Size1" [(ngModel)]="itemRateAnalysis[i].material_rate_analysis[j]['length']" (change)="grandTotal(i)"></td>
                                <td><input mdInput type="number" class="inp" name="Size2" [(ngModel)]="itemRateAnalysis[i].material_rate_analysis[j]['breadth']" (change)="grandTotal(i)"></td>
                                <td><input mdInput type="number" class="inp" name="Size3" [(ngModel)]="itemRateAnalysis[i].material_rate_analysis[j]['thickness']" (change)="grandTotal(i)"></td>
                                <td><input mdInput type="number" class="inp" name="qty" [(ngModel)]="itemRateAnalysis[i].material_rate_analysis[j]['quantity']" (change)="grandTotal(i)"></td>
                                <td><input mdInput type="text" class="inp" name="uom" [(ngModel)]="itemRateAnalysis[i].material_rate_analysis[j]['uom']" (change)="grandTotal(i)"></td>
                                <td><input mdInput type="number" class="inp" name="wastage" [(ngModel)]="itemRateAnalysis[i].material_rate_analysis[j]['wastage']" [attr.Value]="wastage" (change)="grandTotal(i)"></td>
                                <td><input mdInput type="number" class="inp" name="rate" [(ngModel)]="itemRateAnalysis[i].material_rate_analysis[j]['rate']" (change)="grandTotal(i)"></td>
                                <td>
                                    <select class="inp" [(ngModel)]="cf_price" (change)="grandTotal(i)" style="padding: 0px">
<!--                                       <md-option [value]="this.cfList">{{ this.cfList }}</md-option> -->
                                      <option [value]="0">0</option>
                                    </select>
                                </td>
                                <td>{{itemRateAnalysis[i].material_rate_analysis[j]['amount']  | number : '2.2-3'| nan}}</td>
                            </tr>
                            <tr>
                                <td colspan=12>
                                <button md-raised-button color="primary" (click)="openDialogSup(i)">Labour Calculation</button>
                                <button md-raised-button color="primary" (click)="postItemRateAnalysis(i)">Save</button>
                                <span class="example-spacer"></span>
                                <md-chip-list class="float-right">
                                <md-chip color="primary" selected="true">Overhead Margin: <b>{{itemRateAnalysis[i].overhead_margin | number : '2.1-2'| nan}}</b></md-chip>
                                <md-chip color="primary" selected="true">Profit Margin: <b>{{itemRateAnalysis[i].profit_margin | number : '2.1-2'| nan}}</b></md-chip>
                                <md-chip color="primary" selected="true">Labour Total: <b>{{itemRateAnalysis[i].labour_total | number : '2.1-2'| nan}}</b></md-chip>
                                <md-chip color="primary" selected="true">Grand Total: <b>{{itemRateAnalysis[i].grand_total | number : '2.1-2'| nan}}</b></md-chip>
                                </md-chip-list>
                                </td>
                            </tr>
                        </tbody>
                    </table>
            </div>
        </div>
</ng-container>
    </div>
  </md-tab>
  <md-tab label="OverHead">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <h3 class="heading">Overheads Rate analysis</h3>
            </div>
        </div>

        <div class="row overflow">
            <div class="col-md-12">
                <button md-raised-button class="float-right">Save</button>
                <table>
                    <thead>
                        <tr>
                            <th width="40px;" class="index">
                              <app-icon [iconName]="'ic_add_box_white_24px'" (click)="addRow2(0)"></app-icon>
                            </th>
                            <th width="40px;">Sr.No</th>
                            <th width="300px;">Description</th>
                            <th width="40px;">Unit</th>
                            <th width="40px;">Duration</th>
                            <th width="40px;">Count</th>
                            <th width="40px;">Quantity</th>
                            <th width="40px;">Rate</th>
                            <th width="40px;">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let calc2 of calcs2; let j=index">
                            <td class="index">
                              <app-icon [iconName]="'ic_delete_white_24px'" (click)="deleteRow2(0,j)"></app-icon>
                            </td>
                            <!-- delete button -->
                            <td>{{j+1}}</td>
                            <!-- Sr. No -->
                            <td><input type="text" class="inp" ></td>
                            <!-- Description -->
                            <td><input type="text" class="inp" ></td>
                            <!-- Unit -->
                            <td><input type="number" class="inp" [(ngModel)]="calc2['v1']" ></td>
                            <!-- Duration -->
                            <td><input type="number" class="inp" [(ngModel)]="calc2['v2']" ></td>
                            <!-- Count -->
                            <td>{{calc2['v1']*calc2['v2'] | number : '2.2-3' | nan}}</td>
                            <!-- Quantity -->
                            <td><input type="number" class="inp" [(ngModel)]="calc2['v3']" ></td>
                            <!-- Rate -->
                            <td>{{calc2['v1']*calc2['v2']*calc2['v3'] | number : '2.2-3' | nan}}</td>
                            <!-- amount -->
                        </tr>
                    </tbody>
                </table>
                <button md-button  (click)="grandTotal2()"><b>GrandTotal:{{grandTotal2V}}</b></button>
            </div>
        </div>
    </div>
  </md-tab>
  <md-tab label="Report">
    Space For Report
  </md-tab>
</md-tab-group>
